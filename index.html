<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Эль Ви-Нар — Диагностический калькулятор</title>

  <style>
    :root { color-scheme: light; }

    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      line-height: 1.35;
      -webkit-overflow-scrolling: touch;
    }

    .wrap { max-width: 760px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 20px; margin: 0 0 8px; }
    h2 { font-size: 16px; margin: 18px 0 8px; }
    p { margin: 8px 0; }
    .note { font-size: 13px; opacity: 0.85; }
    .card { border: 1px solid rgba(0,0,0,0.12); border-radius: 12px; padding: 12px; margin: 10px 0; }

    .checklist { display: grid; gap: 10px; touch-action: manipulation; }
    label { display: flex; gap: 10px; align-items: flex-start; cursor: pointer; }
    label span { line-height: 1.45; }
    input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex: 0 0 auto; }

    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    button { border: 1px solid rgba(0,0,0,0.15); background: #fff; border-radius: 10px; padding: 10px 12px; cursor: pointer; }
    button:hover { background: rgba(0,0,0,0.03); }

    .small { font-size: 13px; }
    textarea { width: 100%; min-height: 90px; resize: vertical; padding: 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.15); }

    .divider { height: 1px; background: rgba(0,0,0,0.08); margin: 14px 0; }
    .muted { opacity: 0.85; }

    input[type="checkbox"]:focus-visible,
    button:focus-visible,
    textarea:focus-visible {
      outline: 2px solid rgba(0,0,0,0.35);
      outline-offset: 2px;
    }

    /* Readable Results UI */
    .results-grid { display: grid; gap: 10px; }
    .box { border: 1px solid rgba(0,0,0,0.10); border-radius: 12px; padding: 12px; background: rgba(0,0,0,0.015); }
    .box h3 { margin: 0 0 8px; font-size: 14px; }
    .kpi { display: grid; gap: 6px; font-size: 13px; }
    .kpi-row { display: flex; justify-content: space-between; gap: 12px; }
    .kpi-row strong { font-weight: 600; }
    ul { margin: 8px 0 0 18px; padding: 0; }
    li { margin: 6px 0; }
    .two-col { display: grid; gap: 10px; }
    @media (min-width: 680px) { .two-col { grid-template-columns: 1fr 1fr; } }

    .plain-output {
      display: none;
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
    }

    /* Print / PDF layout */
    @media print {
      body { margin: 0; }
      .wrap { max-width: 100%; padding: 0; }
      .card { border: 0; border-radius: 0; padding: 0; margin: 12px 0; }
      .row, .note.print-hide, .print-hide { display: none !important; }
      textarea { border: 0; padding: 0; min-height: 0; }
      .divider { display: none; }
      label { cursor: default; }
      input[type="checkbox"] { transform: translateY(1px); }
      h1 { font-size: 18px; margin-bottom: 6px; }
      h2 { font-size: 14px; margin: 10px 0 6px; }
      .box { break-inside: avoid; }
      p { break-inside: avoid; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Диагностика тэттраглифа Эль Ви-Нар — «Заземление»</h1>
    <p class="note">Период наблюдения: последние 3–7 дней. Отмечайте только то, что вы действительно наблюдали, без оценки и интерпретации.</p>

    <div class="card">
      <h2>Часть I. Наблюдения</h2>
      <div class="checklist" id="part1Mixed"></div>
    </div>

    <div class="card">
      <h2>Часть II. Удержание состояния во времени</h2>
      <p class="note">Под «нагрузкой» понимаются обычные жизненные ситуации: работа, общение, ответственность, усталость, необходимость принимать решения.</p>
      <div class="checklist" id="hold"></div>
    </div>

    <div class="card">
      <h2>Часть III. Итоговая фиксация</h2>

      <p class="small">Примеры из жизни:</p>
      <textarea id="examples" placeholder="Запишите 2–5 коротких примеров из наблюдений..."></textarea>

      <div class="divider"></div>

      <p class="small">Мой личный фокус на следующие дни:</p>
      <textarea id="next" placeholder="Запишите, на что вы будете обращать внимание в следующие дни..."></textarea>
    </div>

    <div class="row print-hide">
      <button id="calc">Рассчитать</button>
      <button id="reset">Сбросить</button>
      <button id="copy">Скопировать результат</button>
      <button id="pdf">Скачать PDF</button>
    </div>

    <div class="card">
      <h2>Результаты</h2>

      <div class="results-grid" id="resultsUI">
        <div class="box">
          <h3>Пока нет результатов</h3>
          <p class="muted" style="margin:0;">Отметьте пункты и нажмите «Рассчитать».</p>
        </div>
      </div>

      <!-- Plain text version used for Copy -->
      <div class="plain-output" id="plainOut"></div>
    </div>

    <p class="note print-hide">Конфиденциальность: страница не отправляет ответы никуда. Всё рассчитывается только в вашем браузере.</p>
  </div>

<script>
  /*
    Part I items are shuffled on each load.
    No visible numbering.
    Each item has a hidden group for correct scoring.
  */

  const part1Items = [
    { group: "stable",  text: "Внимание удерживается в текущем действии, без необходимости специально себя возвращать." },
    { group: "stable",  text: "В теле большую часть времени ощущается опора без зажима и усилия." },
    { group: "stable",  text: "Я ясно ощущаю факт своего присутствия, без необходимости его подтверждать." },
    { group: "stable",  text: "Я понимаю, что делаю и зачем, без внутреннего шума и противоречивых импульсов." },
    { group: "stable",  text: "Я чувствую своё внутреннее состояние и не теряю с ним контакт, даже когда занят(а) делами." },
    { group: "stable",  text: "Я вижу, что происходит сейчас, и понимаю следующий практический шаг." },
    { group: "stable",  text: "Повседневные ситуации в целом переживаются как выдерживаемые и понятные." },
    { group: "stable",  text: "Присутствие естественно переходит в действия и решения, без разрыва между ощущением и поступком." },

    { group: "shadow",  text: "Внимание часто уходит в прошлое или тревожное будущее." },
    { group: "shadow",  text: "Я замечаю фоновое сканирование угроз или ожидание проблем." },
    { group: "shadow",  text: "Даже в спокойных ситуациях внутри остаётся настороженность." },
    { group: "shadow",  text: "Опора ощущается через напряжение, собранность или контроль." },
    { group: "shadow",  text: "Реальность часто переживается как хаотичная, давящая или небезопасная." },
    { group: "shadow",  text: "Решения принимаются, чтобы быстрее снизить внутреннее напряжение." },
    { group: "shadow",  text: "Я избегаю некоторых шагов, потому что они вызывают внутренний дискомфорт." },

    { group: "falseact", text: "Иногда кажется, что я в опоре, но это состояние быстро рассеивается." },
    { group: "falseact", text: "Чтобы быть устойчивым(ой), мне нужно каждый раз «собираться»." },
    { group: "falseact", text: "Я могу много делать, но при этом не чувствовать присутствия в этих действиях." },
    { group: "falseact", text: "После ощущения устойчивости напряжение или тревога возвращаются." }
  ];

  const holdItems = [
    "Опора ощущается не только в спокойных условиях, но и в повседневной нагрузке.",
    "Внимание остаётся в настоящем даже при усталости или напряжении.",
    "Мне не нужно специально возвращать себя в присутствие, чтобы быть устойчивым(ой).",
    "Действия сохраняют последовательность без внутреннего давления.",
    "Повседневные задачи не выбивают из состояния присутствия."
  ];

  function shuffle(array) {
    const a = array.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function escapeAttr(s) {
    return (s || "")
      .replaceAll("&", "&amp;")
      .replaceAll("\"", "&quot;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;");
  }

  function renderPart1Mixed() {
    const root = document.getElementById("part1Mixed");
    root.innerHTML = "";
    const mixed = shuffle(part1Items);
    mixed.forEach((item, idx) => {
      const id = `p1-${idx}-${Math.random().toString(16).slice(2)}`;
      const label = document.createElement("label");
      label.innerHTML =
        `<input type="checkbox"
                id="${id}"
                data-group="${item.group}"
                data-text="${escapeAttr(item.text)}">
         <span>${item.text}</span>`;
      root.appendChild(label);
    });
  }

  function renderHold() {
    const root = document.getElementById("hold");
    root.innerHTML = "";
    holdItems.forEach((text, idx) => {
      const id = `hold-${idx}`;
      const label = document.createElement("label");
      label.innerHTML =
        `<input type="checkbox"
                id="${id}"
                data-group="hold"
                data-text="${escapeAttr(text)}">
         <span>${text}</span>`;
      root.appendChild(label);
    });
  }

  renderPart1Mixed();
  renderHold();

  function countGroup(groupId) {
    return [...document.querySelectorAll(`input[data-group="${groupId}"]`)].filter(x => x.checked).length;
  }

  /*
    IMPORTANT: Do not change these band* functions.
    They are used for UI only ("Интерпретация шкал").
  */
  function bandStable(c) {
    if (c >= 6) return "выражено ясно";
    if (c >= 3) return "присутствует частично";
    return "выражено слабо";
  }

  function bandShadow(c) {
    if (c >= 4) return "выражено сильно";
    if (c >= 2) return "проявляется точечно";
    return "почти не проявляется";
  }

  function bandFalse(c) {
    if (c >= 3) return "высокая вероятность";
    if (c >= 1) return "проявляется ситуативно";
    return "почти не проявляется";
  }

  function bandHold(c) {
    if (c >= 4) return "удерживается фоново";
    if (c >= 2) return "активируется осознанно";
    return "удержание слабое";
  }

  /*
    Frozen mapping functions (mapZ/mapS/mapF/mapU).
  */
  function mapZ(Z) {
    if (Z >= 6) return "Z_clear";
    if (Z >= 3) return "Z_partial";
    return "Z_low";
  }

  function mapS(S) {
    if (S >= 4) return "S_strong";
    if (S >= 2) return "S_point";
    return "S_none";
  }

  function mapF(F) {
    if (F >= 3) return "F_high";
    if (F >= 1) return "F_situ";
    return "F_none";
  }

  function mapU(U) {
    if (U >= 4) return "U_bg";
    if (U >= 2) return "U_act";
    return "U_weak";
  }

  /*
    Text updates per spec.
    BASE_TEXT shortened to reduce overlap with anchor evidence.
  */
  const BASE_TEXT = {
    Z_clear: {
      S_none: "Устойчивое заземление у вас собрано и проявляется ясно, а теневая реализация почти не вмешивается. Присутствие естественно переходит в действия и решения, а внешняя реальность в целом ощущается выдерживаемой и понятной для взаимодействия.",
      S_point: "Устойчивое заземление выражено ясно, но теневая реализация проявляется точечно. В целом опора есть, однако в отдельных ситуациях может включаться настороженность, контроль или внутреннее напряжение.",
      S_strong: "Устойчивое заземление выражено ясно, и при этом теневая реализация заметно выражена. Опора присутствует, но может ощущаться как «держится на собранности»: внутри остаётся фоновая нагрузка, настороженность или контроль."
    },
    Z_partial: {
      S_none: "Картина похожа на стадию формирования опоры: элементы устойчивого заземления уже есть, но проявляются не всегда одинаково. При этом теневая реализация почти не вмешивается, поэтому состояние формируется относительно чисто.",
      S_point: "Опора уже начинает складываться, но пока держится неравномерно. Теневая реализация проявляется точечно и даёт эффект «то получилось, то снова требуется вернуться в опору».",
      S_strong: "Элементы устойчивого заземления присутствуют частично, но теневая реализация выражена сильно. Опора уже появляется, однако фон тревожного сканирования, контроль или настороженность нередко перехватывают управление."
    },
    Z_low: {
      S_none: "Элементы устойчивого заземления выражены слабо, а теневая реализация почти не проявляется. Скорее всего, присутствие и опора сейчас не являются устойчивым фоном: связь между ощущением и поступком возникает эпизодически.",
      S_point: "Устойчивое заземление выражено слабо, а теневая реализация проявляется точечно. Обычно это ощущается как общая неустойчивость присутствия, к которой добавляются отдельные эпизоды настороженности, напряжения или ощущения небезопасности.",
      S_strong: "Устойчивое заземление выражено слабо, и при этом теневая реализация выражена сильно. В такой конфигурации теневая динамика часто становится ведущей: внимание уходит в тревожное будущее или прошлое, включается сканирование угроз, а опора ощущается через напряжение и контроль."
    }
  };

  /*
    FALSE_TEXT shortened to avoid repeating focus.
  */
  const FALSE_TEXT = {
    F_situ: "Ложная активация проявляется ситуативно: в отдельных ситуациях состояние выглядит устойчивым, но не удерживается как фон.",
    F_high: "Ложная активация выражена сильно: ощущение устойчивости может возникать, но быстро распадается, особенно при смене задачи, общения или на фоне усталости."
  };

  /*
    HOLD_TEXT remains unchanged (already non-repetitive).
  */
  const HOLD_TEXT = {
    U_bg: "По удержанию во времени видно, что состояние присутствия способно сохраняться не только в спокойных условиях, но и в обычной повседневной нагрузке. Это делает картину более устойчивой: даже если есть точечные сложности, базовая опора остаётся доступной.",
    U_act: "По удержанию во времени видно, что состояние чаще включается осознанно, чем держится фоном. То есть опора доступна, но требует намеренного возвращения в присутствие — особенно в нагрузке, общении и ответственности.",
    U_weak: "По удержанию во времени видно, что состояние удерживается слабо. Это означает, что даже если элементы заземления появляются, они быстро рассеиваются под нагрузкой и требуют повторной сборки."
  };

  /*
    FOCUS_TEXT: only FOCUS_FALSE updated (full object provided for easy replacement).
  */
  const FOCUS_TEXT = {
    FOCUS_GROUNDING_NOT_CLEAR: "В ближайшие 3–7 дней фиксируйте конкретные ситуации, где присутствие держится, и где оно теряется: что было в контексте, какая нагрузка, какая задача, какое общение. Это поможет увидеть, за счёт чего состояние собирается и что именно его расшатывает.",
    FOCUS_SHADOW_STRONG: "В ближайшие 3–7 дней отмечайте, в каких ситуациях включается настороженность, контроль или фоновое ожидание проблем, и как это влияет на ощущение опоры и последовательность действий. Старайтесь фиксировать именно факты и условия, а не оценку себя.",
    FOCUS_FALSE: "В ближайшие 3–7 дней отмечайте моменты, когда устойчивость возникает и затем теряется: что именно запускает это состояние и что происходит прямо перед его распадом. Это даст материал для уточнения «ложных точек опоры» в следующем заполнении.",
    FOCUS_HOLD_WEAK: "В ближайшие 3–7 дней фиксируйте, что именно выбивает состояние присутствия в повседневной нагрузке и сколько времени требуется, чтобы оно вернулось. Здесь важна повторяемость: одинаковые триггеры и одинаковые сценарии потери удержания.",
    FOCUS_STABLE: "В ближайшие 3–7 дней отмечайте, какие условия поддерживают состояние присутствия как фон, и в каких редких случаях оно всё же становится менее доступным. Это поможет точнее увидеть границы устойчивости и типовые исключения из стабильной картины."
  };

  /*
    chooseFocus priorities remain unchanged.
  */
  function chooseFocus(F_level, U_level, S_level, Z_level) {
    if (F_level !== "F_none") return "FOCUS_FALSE";
    if (U_level === "U_weak") return "FOCUS_HOLD_WEAK";
    if (S_level === "S_strong") return "FOCUS_SHADOW_STRONG";
    if (Z_level !== "Z_clear") return "FOCUS_GROUNDING_NOT_CLEAR";
    return "FOCUS_STABLE";
  }

  function joinPartsInOrder(parts) {
    return parts.filter(Boolean).join("\n\n");
  }

  /*
    New anchor concept: factual evidence from checked items.
  */
  function getCheckedTextsByGroup(groupId) {
    return [...document.querySelectorAll(`input[data-group="${groupId}"]`)]
      .filter(x => x.checked)
      .map(x => (x.getAttribute("data-text") || "").trim())
      .filter(Boolean);
  }

  function truncateText(s, maxLen) {
    const t = (s || "").trim();
    if (t.length <= maxLen) return t;
    return t.slice(0, maxLen - 1).trimEnd() + "…";
  }

  function chooseAnchorGroup(F_level, S_level) {
    if (F_level !== "F_none") return "falseact";
    if (S_level !== "S_none") return "shadow";
    return "stable";
  }

  function buildAnchorEvidence(anchorGroup, maxItems = 2, maxLen = 110) {
    const items = getCheckedTextsByGroup(anchorGroup)
      .slice(0, maxItems)
      .map(t => `«${truncateText(t, maxLen)}»`);

    if (items.length === 0) return "";

    const lead =
      anchorGroup === "falseact" ? "В ваших отметках это проявилось так:" :
      anchorGroup === "shadow"   ? "В ваших отметках это заметно по тому, что вы отметили:" :
                                   "В ваших отметках это подтверждается тем, что вы отметили:";

    return `${lead} ${items.join("; ")}.`;
  }

  /*
    Personal summary: base + anchor evidence + false label + hold + focus.
  */
  function buildPersonalSummary(stableC, shadowC, falseC, holdC) {
    const Z_level = mapZ(stableC);
    const S_level = mapS(shadowC);
    const F_level = mapF(falseC);
    const U_level = mapU(holdC);

    const baseText = BASE_TEXT[Z_level][S_level];

    const anchorGroup = chooseAnchorGroup(F_level, S_level);
    const anchorText = buildAnchorEvidence(anchorGroup, 2, 110);

    let falseText = "";
    if (F_level === "F_situ") falseText = FALSE_TEXT.F_situ;
    if (F_level === "F_high") falseText = FALSE_TEXT.F_high;

    const holdText = HOLD_TEXT[U_level];

    const focusKey = chooseFocus(F_level, U_level, S_level, Z_level);
    const focusText = FOCUS_TEXT[focusKey];

    return joinPartsInOrder([baseText, anchorText, falseText, holdText, focusText]);
  }

  /*
    Method note rule remains unchanged:
    show only if (stableC >= 3) && (shadowC >= 2).
    Text remains exactly as the previous version.
  */
  function getMethodNote(stableC, shadowC, falseC) {
    const has_grounding = (stableC >= 3);
    const has_shadow = (shadowC >= 2);

    if (has_grounding && has_shadow) {
      return "Если одновременно присутствуют элементы устойчивого заземления и тени — это самый частый и самый здоровый вариант. Он означает, что опора уже формируется, но ещё не удерживается одинаково во всех ситуациях. Если присутствуют элементы ложной активации — это указывает на места, где состояние похоже на заземление, но пока не удерживается.";
    }
    return null;
  }

  function renderParagraphsFromText(text) {
    const safe = (text || "").trim();
    if (!safe) return "<p class=\"muted\" style=\"margin:0;\">—</p>";
    const parts = safe.split("\n\n").map(s => s.trim()).filter(Boolean);
    return parts.map(p => `<p style="margin:0 0 8px;">${escapeHtml(p)}</p>`).join("");
  }

  function escapeHtml(s) {
    return s.replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll("\"", "&quot;")
            .replaceAll("'", "&#039;");
  }

  function setResultsUI(payload) {
    const root = document.getElementById("resultsUI");
    root.innerHTML = "";

    const { stableC, shadowC, falseC, holdC, examples, next, personalSummary, methodNote } = payload;

    const kpiBox = document.createElement("div");
    kpiBox.className = "box";
    kpiBox.innerHTML = `
      <h3>Карта состояния</h3>
      <div class="kpi">
        <div class="kpi-row"><span>Устойчивое заземление</span><strong>${stableC} / 8</strong></div>
        <div class="kpi-row"><span>Теневая реализация</span><strong>${shadowC} / 7</strong></div>
        <div class="kpi-row"><span>Ложная активация</span><strong>${falseC} / 4</strong></div>
        <div class="kpi-row"><span>Удержание во времени</span><strong>${holdC} / 5</strong></div>
      </div>
    `;
    root.appendChild(kpiBox);

    const two = document.createElement("div");
    two.className = "two-col";

    const interpret = document.createElement("div");
    interpret.className = "box";
    interpret.innerHTML = `
      <h3>Интерпретация шкал</h3>
      <ul>
        <li><strong>Устойчивое заземление:</strong> ${bandStable(stableC)}.</li>
        <li><strong>Теневая реализация:</strong> ${bandShadow(shadowC)}.</li>
        <li><strong>Ложная активация:</strong> ${bandFalse(falseC)}.</li>
        <li><strong>Удержание:</strong> ${bandHold(holdC)}.</li>
      </ul>
    `;

    const personal = document.createElement("div");
    personal.className = "box";
    personal.innerHTML = `
      <h3>Персональный вывод</h3>
      ${renderParagraphsFromText(personalSummary)}
    `;

    two.appendChild(interpret);
    two.appendChild(personal);
    root.appendChild(two);

    if (methodNote !== null) {
      const methodBox = document.createElement("div");
      methodBox.className = "box";
      methodBox.innerHTML = `
        <h3>Методическая справка</h3>
        ${renderParagraphsFromText(methodNote)}
      `;
      root.appendChild(methodBox);
    }

    const notesBox = document.createElement("div");
    notesBox.className = "box";
    notesBox.innerHTML = `
      <h3>Личные заметки</h3>
      <p class="muted" style="margin:0 0 8px;"><strong>Примеры из жизни:</strong><br>${escapeHtml(examples || "—")}</p>
      <p class="muted" style="margin:0;"><strong>Мой личный фокус на следующие дни:</strong><br>${escapeHtml(next || "—")}</p>
    `;
    root.appendChild(notesBox);
  }

  function setPlainText(payload) {
    const { stableC, shadowC, falseC, holdC, examples, next, personalSummary, methodNote } = payload;
    const methodLine = (methodNote === null) ? "—" : methodNote;

    const text =
`СВОДКА
Устойчивое заземление: ${stableC} из 8
Теневая реализация: ${shadowC} из 7
Ложная активация: ${falseC} из 4
Удержание во времени: ${holdC} из 5

ИНТЕРПРЕТАЦИЯ
Устойчивое заземление: ${bandStable(stableC)}
Теневая реализация: ${bandShadow(shadowC)}
Ложная активация: ${bandFalse(falseC)}
Удержание: ${bandHold(holdC)}

ПЕРСОНАЛЬНЫЙ ВЫВОД
${personalSummary}

МЕТОДИЧЕСКАЯ СПРАВКА
${methodLine}

ПРИМЕРЫ ИЗ ЖИЗНИ
${examples || "—"}

ФОКУС НА СЛЕДУЮЩИЕ ДНИ
${next || "—"}
`;
    document.getElementById("plainOut").textContent = text;
  }

  document.getElementById("calc").addEventListener("click", () => {
    const stableC = countGroup("stable");
    const shadowC = countGroup("shadow");
    const falseC  = countGroup("falseact");
    const holdC   = countGroup("hold");

    const examples = document.getElementById("examples").value.trim();
    const next = document.getElementById("next").value.trim();

    const payload = {
      stableC,
      shadowC,
      falseC,
      holdC,
      examples,
      next,
      personalSummary: buildPersonalSummary(stableC, shadowC, falseC, holdC),
      methodNote: getMethodNote(stableC, shadowC, falseC)
    };

    setResultsUI(payload);
    setPlainText(payload);
  });

  document.getElementById("reset").addEventListener("click", () => {
    document.querySelectorAll('input[type="checkbox"]').forEach(x => x.checked = false);
    document.getElementById("examples").value = "";
    document.getElementById("next").value = "";

    const root = document.getElementById("resultsUI");
    root.innerHTML = `
      <div class="box">
        <h3>Пока нет результатов</h3>
        <p class="muted" style="margin:0;">Отметьте пункты и нажмите «Рассчитать».</p>
      </div>
    `;
    document.getElementById("plainOut").textContent = "";

    renderPart1Mixed();
  });

  document.getElementById("copy").addEventListener("click", async () => {
    const t = document.getElementById("plainOut").textContent.trim();
    if (!t) {
      alert("Сначала нажмите «Рассчитать», чтобы появился результат.");
      return;
    }
    try {
      await navigator.clipboard.writeText(t);
      alert("Результат скопирован.");
    } catch {
      alert("Не удалось скопировать автоматически. На iPhone/iPad выделите текст результата и скопируйте вручную.");
    }
  });

  document.getElementById("pdf").addEventListener("click", () => {
    window.print();
  });
</script>
</body>
</html>
